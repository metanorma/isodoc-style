!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){return r(this,e),this}return o(e,[{key:"fromRange",value:function(e,t){Object.defineProperty(this,"tmp",{value:null,enumerable:!1,writable:!0}),this.tmp=e}},{key:"firstRange",value:function(e){return this.tmp}},{key:"toRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);var t=this.firstRange(e);if(null===t)return console.warn("selector did not find any results. Return null and aborting further refinement so upstream selectors know to move on and try possible alternatives."),null;if(void 0===this.refinedBy)return t;if(Array.isArray(this.refinedBy))for(var n=0;n<this.refinedBy.length;n++){var r=this.refinedBy[n].toRange(t);if(null!==r)return r}else{var o=this.refinedBy.toRange(t);if(null!==o)return o}}},{key:"toSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=window.getSelection();t.removeAllRanges();var n=this.toRange();if(t.addRange(n),e){var r=Math.round(window.scrollY+n.getBoundingClientRect().top),o=Math.round(window.scrollY+window.innerHeight),i=Math.round(window.scrollY);(r>o||r<i)&&window.scroll(0,r)}return this}},{key:"fromSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getSelection();if(null===e.anchorNode)throw new Error("user selection in document window is empty. There is no anchorNode indicating its even starting.");return this.fromRange(e.getRangeAt(0)),this}}]),e}();t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(5)),u=r(n(6)),l=r(n(7)),s=r(n(8)),c=r(n(9)),f=r(n(10)),d=r(n(2)),h=r(n(11)),p=r(n(12)),v=function(){function e(){return o(this,e),this.result=new a.default,Object.defineProperty(this,"uuid",{value:p.default.v4(),enumerable:!1,writable:!0}),Object.defineProperty(this,"url",{value:e.parseURL(window.location.href),enumerable:!1,writable:!0}),this}return i(e,[{key:"toJSON",value:function(){return JSON.stringify(this.result)}},{key:"fromJSON",value:function(e){return this.result=JSON.parse(e,function(e,t){if(null===t||!t.hasOwnProperty("type"))return this[e];switch(t.type){case"Annotation":return new a.default(t);case"SpecificResource":return new u.default(t);case"RangeSelector":return new l.default(t);case"XPathSelector":return new s.default(t);case"DataPositionSelector":return new c.default(t);case"TextQuoteSelector":return new f.default(t);case"TextPositionSelector":return new d.default(t);default:console.warn("mismatched type attribute in JSON reviver function")}}),this}},{key:"bookmark",value:function(){return this.result.motivation="bookmarking",this.result.canonical="urn:uuid:"+this.uuid,this.result.target=new h.default,this.result.target.id=this.url,this}},{key:"highlight",value:function(t){if(void 0===t&&(t=document.getSelection()),null===t.anchorNode||t.isCollapsed)throw new Error("user selection in document window is empty (indicating nothing pressed) or collapsed (indicating mere touch or press in window). In general might use scroll position to get a fragment selector, but not valid for highlighting motivation.");var n=t.getRangeAt(0),r=e.rangeType(n);if(r.includes(e.END_DOCUMENT_NODE()))throw new Error("invalid end of range such as a brand new Range object collapsed at the start of the document root");this.result.motivation="highlighting",this.result.canonical="urn:uuid:"+this.uuid;var o=new u.default;if(o.source=this.url,o.selector=[],r.includes(e.ONE_CONTAINER_NODE())){var i=new s.default;r.includes(e.START_SUBSTRING_DATA())&&(i.refinedBy=new c.default),i.fromRange(n),o.selector.push(i)}else{var a=new l.default;a.startSelector=new s.default,a.endSelector=new s.default,r.includes(e.START_SUBSTRING_DATA())&&(a.startSelector.refinedBy=new c.default),(r.includes(e.END_SUBSTRING_DATA())||r.includes(e.END_CHARACTER_NODE()))&&(a.endSelector.refinedBy=new c.default),a.fromRange(n),o.selector.push(a)}var d=(new f.default).fromRange(n);return o.selector.push(d),o.selector.push(d.toTextPositionSelector()),this.result.target=o,this}}],[{key:"START_DOCUMENT_NODE",value:function(){return 1}},{key:"START_ELEMENT_NODE",value:function(){return 2}},{key:"START_CHARACTER_NODE",value:function(){return 3}},{key:"START_SUBSTRING_DATA",value:function(){return 4}},{key:"END_DOCUMENT_NODE",value:function(){return 5}},{key:"END_ELEMENT_NODE",value:function(){return 6}},{key:"END_CHARACTER_NODE",value:function(){return 7}},{key:"END_SUBSTRING_DATA",value:function(){return 8}},{key:"ONE_CONTAINER_NODE",value:function(){return 9}},{key:"COLLAPSED",value:function(){return 10}},{key:"rangeType",value:function(t){var n=[];if(t.startContainer.nodeType===Node.DOCUMENT_NODE&&n.push(e.START_DOCUMENT_NODE()),t.endContainer.nodeType===Node.DOCUMENT_NODE&&n.push(e.END_DOCUMENT_NODE()),t.startContainer.nodeType===Node.ELEMENT_NODE&&n.push(e.START_ELEMENT_NODE()),t.endContainer.nodeType===Node.ELEMENT_NODE&&n.push(e.END_ELEMENT_NODE()),[Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(t.startContainer.nodeType)){var r=t.startContainer.nodeValue.length;t.startContainer===t.endContainer?(n.push(e.ONE_CONTAINER_NODE()),t.startOffset===t.endOffset?n.push(e.COLLAPSED()):0===t.startOffset&&t.endOffset===r?n.push(e.START_CHARACTER_NODE()):n.push(e.START_SUBSTRING_DATA())):0===t.startOffset?n.push(e.START_CHARACTER_NODE()):n.push(e.START_SUBSTRING_DATA())}if([Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(t.endContainer.nodeType)){var o=t.endContainer.nodeValue.length;t.startContainer===t.endContainer?0===t.startOffset&&t.endOffset===o?n.push(e.END_CHARACTER_NODE()):n.push(e.END_SUBSTRING_DATA()):t.endOffset===o?n.push(e.END_CHARACTER_NODE()):n.push(e.END_SUBSTRING_DATA())}return n}},{key:"parseURL",value:function(e){var t=document.createElement("a");return t.href=e,"javascript:"===t.protocol.toLowerCase()?(console.warn("supplied URL path is javascript and could be mallicious."),null):t.protocol+"//"+t.host+t.pathname+t.search+t.hash}}]),e}();t.default=v},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{start:null,end:null};r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.type="TextPositionSelector",n.start=e.start,n.end=e.end,n}return i(t,u.default),a(t,[{key:"_textNodeIterator",value:function(e){var t=e.commonAncestorContainer;return t.nodeType===Node.TEXT_NODE?t=t.parentElement:t.nodeType===Node.DOCUMENT_NODE&&(t=document.documentElement),document.createNodeIterator(t,NodeFilter.SHOW_TEXT,{acceptNode:function(t){if(t===e.startContainer||t===e.endContainer||0===e.comparePoint(t,0))return NodeFilter.FILTER_ACCEPT}})}},{key:"fromRange",value:function(e,t){void 0===t&&(t=new Range).selectNode(document.documentElement);for(var n=this._textNodeIterator(t),r=0,o=null,i=null,a=null,u=null,l=void 0;l=n.nextNode();){var s=l.nodeValue.length;if(null===o&&(l===t.startContainer?o=r+t.startOffset:0===t.comparePoint(l,0)&&(o=r)),null===i&&l===t.endContainer&&(i=r+t.endOffset),null!==o&&null===a&&(l===e.startContainer?a=r-o+e.startOffset:0===e.comparePoint(l,0)&&(a=r-o)),null!==o&&null===u&&(l===e.endContainer?u=r-o+e.endOffset:1===e.comparePoint(l,0)&&(u=r-o)),null!==a&&null!==u){this.start=a,this.end=u;break}r+=s}return this}},{key:"firstRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);for(var t=this._textNodeIterator(e),n=this.start,r=this.end,o=0,i=null,a=null,u=null,l=null,s=null,c=null,f=void 0;f=t.nextNode();){var d=f.nodeValue.length;if(null===i&&(f===e.startContainer?i=o+e.startOffset:0===e.comparePoint(f,0)&&(i=o)),null===a&&f===e.endContainer&&(a=o+e.endOffset),null!==i&&null===u&&o+d>=n+i&&o<n+i&&(u=f,l=n+i-o),null!==i&&null===s&&o+d>=r+i&&o<r+i&&(s=f,c=r+i-o),null!==u&&null!==s)break;o+=d}var h=new Range;return h.setStart(u,l),h.setEnd(s,c),h}}]),t}();t.default=l},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";var r=n(1).default;"undefined"!=typeof process&&"number"==typeof process.pid?e.exports=r:window&&(window.AnnotationBuilder=r)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:null,target:null};return r(this,e),this["@context"]="http://www.w3.org/ns/anno.jsonld",this.type="Annotation",this.id=t.id,this.target=t.target,void 0!==t.motivation&&(this.motivation=t.motivation),void 0!==t.canonical&&(this.canonical=t.canonical),void 0!==t.bodyValue&&(this.bodyValue=t.bodyValue),void 0!==t.body&&(this.body=t.body),this}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{source:null,selector:null};return r(this,e),this.type="SpecificResource",this.source=String(t.source),void 0!==t.id&&(this.id=t.id),void 0!==t.selector&&(this.selector=t.selector),this}return o(e,[{key:"firstRange",value:function(){if(this.source!==i.default.parseURL(window.location.href))throw new Error("currently does not support selecting on other than current page. should add code to navigate to page or otherwise return null (but trying the first option before throwing null is best)");var e=new Range;if(e.selectNode(document.documentElement),void 0===this.selector)return e;if(Array.isArray(this.selector))for(var t=0;t<this.selector.length;t++){var n=this.selector[t].toRange(e);if(null!==n)return n}else{var r=this.selector.toRange(e);if(null!==r)return r}return null}},{key:"toRange",value:function(){return this.firstRange()}},{key:"toSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=window.getSelection();t.removeAllRanges();var n=this.toRange();if(t.addRange(this.toRange()),e){var r=Math.round(window.scrollY+n.getBoundingClientRect().top),o=Math.round(window.scrollY+window.innerHeight),i=Math.round(window.scrollY);(r>o||r<i)&&window.scroll(0,r)}return this}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startSelector:new u.default,endSelector:new u.default};r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.type="RangeSelector",i.startSelector=n.startSelector,i.endSelector=n.endSelector,e=i,o(i,e)}return i(t,u.default),a(t,[{key:"firstRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);var t=this.startSelector.toRange(e),n=this.endSelector.toRange(e),r=new Range;return r.setStart(t.startContainer,t.startOffset),r.setEnd(n.startContainer,n.startOffset),r}},{key:"fromRange",value:function(e,t){void 0===t&&(t=new Range).selectNode(document.documentElement);var n=new Range;n.setStart(e.startContainer,e.startOffset),n.setEnd(e.startContainer,e.startOffset),this.startSelector.fromRange(n,t);var r=new Range;return r.setStart(e.endContainer,e.endOffset),r.setEnd(e.endContainer,e.endOffset),this.endSelector.fromRange(r,t),this}}]),t}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{value:null};r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.type="XPathSelector",i.value=n.value,void 0!==n.refinedBy&&(i.refinedBy=n.refinedBy),e=i,o(i,e)}return i(t,u.default),a(t,[{key:"firstRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);for(var t=document.evaluate(this.value,e.commonAncestorContainer,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),n=[],r=void 0;r=t.iterateNext();)if(r===e.startContainer)n.push(r);else{if(r===e.endContainer){n.push(r);break}0===e.comparePoint(r,0)&&n.push(r)}if(0===n.length)throw new Error("could not use xpath to find one element in a particular refinedRange. did page change? not a huge issue, might have better contintencies.");for(var o=0;o<n.length;o++){var i=new Range;return[Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(n[o].nodeType)?(i.setStart(n[o],0),i.setEnd(n[o],n[o].nodeValue.length)):i.selectNode(n[o]),i}return null}},{key:"fromRange",value:function(e,t){if(void 0===t&&(t=new Range).selectNode(document.documentElement),e.startContainer!==e.endContainer)throw new Error("XPath selector can currently only encapsulate a single node, and a range that spans nodes was provided");var n=void 0;n=[Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(e.startContainer.nodeType)?e.startContainer:e.startContainer.childNodes[e.startOffset];for(var r=[],o=["id","role","name","itemid","itemtype","itemprop"],i=["address","article","aside","footer","h1","header","hgroup","nav","section","main","body"],a=!1,u=!1,l=!0;l;){var s={};if(s.NodeTest="*",s.AttributePredicate={},s.PositionPredicate=null,3===n.nodeType)s.NodeTest="text()";else{if(9===n.nodeType){if(s.NodeTest="",this._setUniqueXpath(this._compileXpath("/",s,r),t)){l=!1;break}return console.warn("did not find a unique xpath for node, even at root level, so there must be an error in the xpath generator code!"),this}for(var c in o){var f=o[c];if(n.hasAttribute(f)&&(0===c&&(a=!0),s.AttributePredicate[f]=n.getAttribute(f),u|a&&this._setUniqueXpath(this._compileXpath("//",s,r),t))){l=!1;break}if(0===c&&(s.NodeTest=n.nodeName.toLowerCase(),i.includes(s.NodeTest)&&(u=!0),u|a&&this._setUniqueXpath(this._compileXpath("//",s,r),t))){l=!1;break}}}if(s.PositionPredicate=this._nodePosition(s,n),r.length>0&&u|a&&this._setUniqueXpath(this._compileXpath("//",s,r),t)){l=!1;break}r.unshift(this._compileXpath("",s)),n=n.parentNode}return void 0!==this.refinedBy&&this.refinedBy.fromRange(e),this}},{key:"_setUniqueXpath",value:function(e,t){return 1===document.evaluate("count("+e+")",t.commonAncestorContainer,null,XPathResult.NUMBER_TYPE,null).numberValue&&(this.value=e,!0)}},{key:"_nodePosition",value:function(e,t){var n=this._compileXpath("",e),r=document.evaluate(n,t.parentNode,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(r.snapshotLength>1){for(var o=0;o<r.snapshotLength;o++)if(r.snapshotItem(o)===t)return o+1}else if(1===r.snapshotLength)return null;throw new Error("error in _nodePosition. Could the node have been removed?")}},{key:"_compileXpath",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"//",t=arguments[1],n=arguments[2],r="";if(r+=t.NodeTest,Object.keys(t.AttributePredicate).length>0){for(var o=Object.keys(t.AttributePredicate),i=[],a=0;a<o.length;a++)i.push("@"+o[a]+'="'+t.AttributePredicate[o[a]]+'"');r=r+"["+i.join(" and ")+"]"}return null!==t.PositionPredicate&&(r=r+"["+t.PositionPredicate+"]"),void 0!==n&&n.length>0&&(r=r+"/"+n.join("/")),r=e+r}}]),t}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{start:0,end:null};r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.type="DataPositionSelector",i.start=n.start,i.end=n.end,e=i,o(i,e)}return i(t,u.default),a(t,[{key:"firstRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);var n=e;if(n.startContainer!==n.endContainer)throw new Error("range must encapsulate one node only");if(![Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(n.startContainer.nodeType))throw new Error("node must be a text node or similar for this to work currently.");for(var r=new Range,o=n.startContainer.nodeValue,i=0,a=!1,u=0;u<=n.endOffset;u++){if(!a&&i>=this.start&&(r.setStart(n.startContainer,u),a=!0),i>=this.end)return r.setEnd(n.startContainer,u),r;var l=t.fixedCharCodeAt(o,u);i+=t.charCodeBytes(l)}return null}},{key:"fromRange",value:function(e,n){if(e.startContainer!==e.endContainer)throw new Error("DataPositionSelector can only represent position in a single node currently");if(![Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.COMMENT_NODE].includes(e.startContainer.nodeType))throw new Error("node must be a text node or similar for this to work currently.");for(var r=e.startContainer.nodeValue,o=0,i=0;i<=e.endOffset;i++){if(i===e.startOffset&&(this.start=o),i===e.endOffset){this.end=o;break}var a=t.fixedCharCodeAt(r,i);o+=t.charCodeBytes(a)}return this}}],[{key:"fixedCharCodeAt",value:function(e,t){t=t||0;var n=e.charCodeAt(t);if(isNaN(n))return null;var r=void 0,o=void 0;if(n>=55296&&n<=56319){if(r=n,o=e.charCodeAt(t+1),isNaN(o))throw new Error("High surrogate not followed by low surrogate in fixedCharCodeAt()");return 1024*(r-55296)+(o-56320)+65536}return n>=56320&&n<=57343?null:n}},{key:"charCodeBytes",value:function(e){return"number"==typeof e?e<128?1:e<2048?2:e<65536?3:e<2097152?4:e<67108864?5:6:0}}]),t}();t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=function(e){return e&&e.__esModule?e:{default:e}}(n(2)),s=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{exact:null,prefix:null,suffix:null};r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.type="TextQuoteSelector",n.exact=e.exact,n.suffix=e.suffix,n.prefix=e.prefix,Object.defineProperty(n,"start",{value:n.start,enumerable:!1,writable:!0}),Object.defineProperty(n,"end",{value:n.end,enumerable:!1,writable:!0}),Object.defineProperty(n,"epsilon",{value:32,enumerable:!1,writable:!0}),n}return i(t,l.default),a(t,[{key:"fromRange",value:function(e,n){void 0===n&&(n=new Range).selectNode(document.documentElement),u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromRange",this).call(this,e,n);var r=n.toString();return this.exact=r.substring(this.start,this.end),this.prefix=r.substring(Math.max(this.start-this.epsilon,0),this.start),this.suffix=r.substring(this.end,Math.min(this.end+this.epsilon,r.length)),this}},{key:"firstRange",value:function(e){void 0===e&&(e=new Range).selectNode(document.documentElement);var n=e.toString().indexOf(this.prefix+this.exact+this.suffix);return-1===n?(console.warn("TextQuoteSelector did not find a string match. returning null. try prefix/suffix and maybe string distance on those?"),null):(this.start=n+this.prefix.length,this.end=this.start+this.exact.length,u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"firstRange",this).call(this,e))}},{key:"toTextPositionSelector",value:function(){return new l.default({start:this.start,end:this.end})}}]),t}();t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:null};return r(this,e),this.type="ExternalWebResource",this.id=t.id,void 0!==t.purpose&&(this.purpose=t.purpose),this}return o(e,[{key:"toRange",value:function(){if(this.source!==i.default.parseURL(window.location.href))throw new Error("currently does not support getting range on other than current page. should add code to navigate to page or otherwise return null (but trying the first option before throwing null is best)");var e=new Range;return e.selectNode(document.documentElement),e}},{key:"toSelection",value:function(){var e=window.getSelection();return e.removeAllRanges(),e.addRange(this.toRange()),this}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e)}return o(e,null,[{key:"v4",value:function(){var t=e._randomBytes(16);t[6]=15&t[6]|64,t[8]=63&t[8]|128;var n=e._isNode()?t.toString("hex"):"";if(""===n)for(var r=0;r<16;r+=1)n+=e._bToStr(t[r]);return n.substr(0,8)+"-"+n.substr(8,4)+"-"+n.substr(12,4)+"-"+n.substr(16,4)+"-"+n.substr(20)}},{key:"_isNode",value:function(){return"undefined"!=typeof process&&"number"==typeof process.pid}},{key:"_randomBytes",value:function(t){var r=void 0;if(e._isNode())return n(13).randomBytes(t);if(!(r=window.crypto||window.msCrypto)){console.warn("Your environment does not support Crypto, falling back to Math.random()");for(var o,i=new Array(t),a=0;a<t;a++)0==(3&a)&&(o=4294967296*Math.random()),i[a]=o>>>((3&a)<<3)&255;return i}return r.getRandomValues(new Uint8Array(t))}},{key:"_bToStr",value:function(e,t){for(var n=t?e.toString(16).substr(t):e.toString(16);n.length<2;)n="0"+n;return n}}]),e}();t.default=i},function(e,t){e.exports=require("crypto")}]);
//# sourceMappingURL=annotation-builder.min.js.map